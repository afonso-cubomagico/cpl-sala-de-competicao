<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cubic Portugal League</title>
  <style>
    /* Fundo “clean” com gradiente suave */
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #e0eafc, #cfdef3);
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
      box-sizing: border-box;
    }
    /* Título mais estilizado */
    h1 {
      color: #2c3e50;
      font-size: 2.5em;
      font-weight: 700;
      margin-bottom: 20px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      letter-spacing: 1px;
    }
    .container {
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      box-sizing: border-box;
      margin-bottom: 20px;
    }
    input, button {
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
      width: 100%;
      border-radius: 10px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background-color: #34495e;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background-color: #2c3e50;
    }
    .scramble {
      font-weight: bold;
      margin: 10px 0;
      font-size: 1.2em;
    }
    /* Penalidades centralizadas verticalmente sob o texto */
    .penalties {
      display: flex;
      justify-content: space-around;
      margin: 10px 0;
    }
    .penalties label {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 16px;
    }
    .penalties input {
      margin-top: 5px;
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f2f2f2;
    }
    /* Esconde as seções que não devem aparecer inicialmente */
    #confirmContainer, #solveContainer, #resultsContainer {
      display: none;
    }
    /* Estilos para estatísticas finais */
    .stats {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <h1>Cubic Portugal League</h1>

  <!-- Container para inserir o ID da sala -->
  <div class="container" id="idContainer">
    <input type="text" id="idInput" placeholder="Introduz o ID da sala">
    <button onclick="verificarID()">Entrar</button>
  </div>

  <!-- Container de confirmação antes de mostrar scrambles e campos de tempo -->
  <div class="container" id="confirmContainer">
    <p style="font-size: 1.1em; text-align: center;">
      É obrigatório que já estejas a gravar esta disputa para continuar
    </p>
    <button onclick="confirmarGravacao()">Confirmo que estou a gravar</button>
  </div>

  <!-- Container onde aparecem scrambles e campos para introduzir tempos -->
  <div class="container" id="solveContainer">
    <div id="solveFields">
      <div id="scramble" class="scramble"></div>
      <input type="text" id="tempoInput" placeholder="Tempo (ex: 12.34)">
      <div class="penalties">
        <label>
          +2
          <input type="checkbox" name="plus2" value="+2">
        </label>
        <label>
          DNF
          <input type="checkbox" name="dnf" value="DNF">
        </label>
      </div>
      <button onclick="submeterTempo()">Submeter tempo</button>
    </div>

    <!-- Tabela de resultados durante as solves -->
    <table id="tabelaTempos">
      <thead>
        <tr><th>Scramble</th><th>Tempo</th><th>Penalidade</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="mediaFinal" style="margin-top:20px; font-weight:bold;"></div>
  </div>

  <!-- Container com resultados finais: tabela + estatísticas -->
  <div class="container" id="resultsContainer">
    <h2>Resultados Finais</h2>

    <table id="finalTabela">
      <thead>
        <tr><th>Scramble</th><th>Tempo</th><th>Penalidade</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- Estatísticas finais: Single à esquerda, Ao5 à direita -->
    <div class="stats">
      <span id="bestSingle"></span>
      <span id="finalAo5"></span>
    </div>
  </div>

  <script>
    // Todos os IDs e as suas scrambles (mantidos como tinhas)
    const scramblesPorID = {
      // Divisão 1
      // Jornada 1
      // Disputa 1
      "8B2A4": [
        "R B' D2 R2 B D2 R2 B' D2 F L2 B' D' B' R' F2 L B R F' ",
        "L D' F R' U L' B R L2 D2 F2 L2 F2 R2 U' D2 R2 D' F ",
        "U' F2 U' R2 U' L2 D2 B2 R2 D2 U' L F' L U F2 R B' D' U R ",
        "L2 F2 D F2 D F2 D2 R2 U2 L2 B2 U' R' D' F2 R U B' D F ",
        "D2 F D2 R' U D2 L' D2 B2 D2 F D2 B D2 R2 B L2 F' R B' "
      ],
      // Disputa 2
      "0V7H1": [
        "U2 R F2 R2 F2 D2 R' F2 R D2 B2 F2 U L2 F2 U F' R B D B'",
        "L' D' L' F U' R' B L2 F2 L2 U R2 U F2 R2 D B2 U2 R D",
        "U B2 R2 D2 L' D2 B2 R D2 R' U2 B2 D2 F U F' D' B' F2 D2 U",
        "R' B' F2 L2 D' L2 D F2 U F2 L2 U2 B' L U2 L2 B' F D'",
        "U' F2 L2 F2 L2 R2 U' L2 D2 B2 U' F L' B R F R' D' U' B' L'"
      ],
      // Disputa 3
      "4QK9M": [
        "D F2 U R2 B2 D F2 U' B2 F2 U2 B U' R2 D2 R F D' L2 B",
        "R' D2 R2 U B' U F' D2 L R2 U2 F R2 B U2 R2 F' B2 L2 F R2",
        "B' U' L' B2 L2 U' L2 R2 F2 U' B2 F2 U B' D' U2 F2 U' L",
        "B F2 D2 B D2 U2 F' D2 L B2 F2 U L' F L2 R' U' F2",
        "L2 D2 L2 D2 B' F' R2 B2 F' D2 F L R' D' L' F2 L' U B2 R'"
      ],
      // Disputa 4
      "F5DZ2": [
        "R D' F' B' U2 B D2 L' F2 U' R2 U R2 L2 U' B2 U F2 U R",
        "R B2 L' F U2 D F' U' F' R F2 B2 D2 R F2 L2 U2 R' U2 R F2",
        "L' U F2 R2 U' F2 L2 R2 U L2 D L2 B2 L' R' F U2 L D F R2",
        "L' D F2 D F2 D F2 D B2 R2 D2 R2 U F' D' L' R' F2 D F' R",
        "F R' U R F2 D' R2 D R' B2 U2 F2 R2 B2 R U2 R D2 F2 D2"
      ],
      // Disputa 5
      "X1J3L": [
        "F' D2 F L2 B F2 D2 U2 F' D2 F2 R F2 D F R2 B' L' B2 D2 U2",
        "B R2 L' U2 L' B D B2 R F2 L F2 R U2 R' U2 L2 U2 L' F U'",
        "F' L B U2 L U D F2 R' D2 F2 D2 B' D2 R2 F B2 R2 F2 R2 D2",
        "R2 B U2 L2 R2 U2 F' D2 B R2 U2 R F' U B R U F' L' D' U2",
        "F R' L' F' R U2 L2 U B2 R' U2 F2 L2 B2 U2 B2 D2 R' U2"
      ],
      // Extra 1
      "RM72C": [
        "F2 D2 L2 U2 L' D2 B2 U2 B2 R2 F2 U' B2 F' L R' B2 F L2 D",
        "D B' L2 U L2 B2 L2 U2 F2 U' R2 D' R U B2 D2 B' D' F R'",
        "R B D' F U2 B2 D2 F D2 B' R2 F R2 L' U R' F D2 L' D'",
        "R U' B' D F2 L2 U B2 R2 D' B2 R2 B2 D' B' L D' F2 L2 U' F2",
        "L2 F' L2 B D2 L2 B' U2 F2 L2 U L R F' R2 D F' U' F'"
      ],
      // Extra 2
      "Z0APW": [
        "L F' L2 F2 U2 B D2 B R2 B L2 D2 L2 D' U2 L2 R' U2 F2 D' L",
        "U' R' B2 U F' U' B' U2 F2 U2 F2 R' D2 F2 L F2 U2 L' D' F",
        "D2 L2 F' D2 B2 D2 B2 R2 D2 U2 B U2 L' B D L R' B2 L D2",
        "F2 D' L2 D2 L' F2 D2 L D2 F2 L2 F2 L' U L B' R2 D' L' F'",
        "U' R D' F2 L2 R2 F2 U F2 R2 D B2 D' B' L D' R' D F D' B2"
      ],
      // Extra 3
      "TL3XN": [
        "F' U' D L' U R2 U2 F' L2 F2 R2 D2 L2 U' R2 U L2 U2 F2",
        "B' U F2 R F D' L B L2 B2 U' F2 R2 U L2 D' L2 D R'",
        "L' B D2 R' B2 L' D2 R U2 F2 L2 F2 R B' L' D2 U B' R2",
        "F U' R' D' L U R' B L' D' L2 D2 R2 F2 U' F2 D R2 F2 B2 R2",
        "R2 D' R L B R F' U F2 L2 F' U2 F' R2 L2 D2 B' R2 F2 R2"
      ],
      // Divisão 2
      // Jornada 1
      // Disputa 1
      "BS68Y": [
        "U B U2 F U2 R2 B' L2 F U2 L D U F2 D' R2 F' R' U'",
        "F2 R B2 R2 D2 F2 R2 F R2 U2 L2 F2 U L2 F' U R' F2 D L'",
        "F D2 F' U2 F L2 R2 D2 L F U2 R2 U' L' D2 R D'",
        "R2 U2 R F2 L' F2 R D2 R2 U2 F U2 F2 D' B D U B2 R2",
        "U' L2 U2 R' D2 R F2 L D2 U2 F2 R' B F' L D L2 D' F D'"
      ],
      // Disputa 2
      "KQJ4F": [
        "F U2 F' L2 D2 B' D2 B' F' L2 F' U' F2 L' D' F U' L' R' U R2",
        "U' D' R2 U L' D2 B U L2 U' R2 U' L2 B2 U L2 F2 D2 B' D2",
        "R F2 L2 U L' F2 R U2 F2 B2 U R2 D B2 L2 D' R2 D B' L2",
        "D B' U' F2 U2 F D2 L2 U2 L2 B' F' L2 F' R D F R2 B' U2 L",
        "U R L2 U L B D' R' U D F2 D' B2 D2 R2 F2 U F2 L'"
      ],
      // Disputa 3
      "DNV59": [
        "F U2 F' L2 D2 B' D2 B' F' L2 F' U' F2 L' D' F U' L' R' U R2",
        "U' D' R2 U L' D2 B U L2 U' R2 U' L2 B2 U L2 F2 D2 B' D2",
        "R F2 L2 U L' F2 R U2 F2 B2 U R2 D B2 L2 D' R2 D B' L2",
        "D B' U' F2 U2 F D2 L2 U2 L2 B' F' L2 F' R D F R2 B' U2 L",
        "U R L2 U L B D' R' U D F2 D' B2 D2 R2 F2 U F2 L'"
      ],
      // Disputa 4
      "U1RXZ": [
        "R2 U L F2 D' F U R2 F B2 U2 R F2 D2 R' U2 F2 D2",
        "U' B F2 R' B2 R2 F2 U2 R D2 R2 F2 B R' B2 F2 U F2 R",
        "R U2 F2 L2 D L2 B2 U' F2 R2 D' U2 R' B2 U F L' R2 U2 F2",
        "U' F' D2 R2 B D2 R2 F' U2 B D2 L B2 U' L R U' F L' D",
        "U B' F2 D2 R F2 L' B2 L D2 R F2 L' B2 U B R B' F' D' U2"
      ],
      
      "U1RXZ": [
        "F U2 F' L2 D2 B' D2 B' F' L2 F' U' F2 L' D' F U' L' R' U R2",
        "U' D' R2 U L' D2 B U L2 U' R2 U' L2 B2 U L2 F2 D2 B' D2",
        "R F2 L2 U L' F2 R U2 F2 B2 U R2 D B2 L2 D' R2 D B' L2",
        "D B' U' F2 U2 F D2 L2 U2 L2 B' F' L2 F' R D F R2 B' U2 L",
        "U R L2 U L B D' R' U D F2 D' B2 D2 R2 F2 U F2 L'"
      ],
      
      "KQJ4F": [
        "F U2 F' L2 D2 B' D2 B' F' L2 F' U' F2 L' D' F U' L' R' U R2",
        "U' D' R2 U L' D2 B U L2 U' R2 U' L2 B2 U L2 F2 D2 B' D2",
        "R F2 L2 U L' F2 R U2 F2 B2 U R2 D B2 L2 D' R2 D B' L2",
        "D B' U' F2 U2 F D2 L2 U2 L2 B' F' L2 F' R D F R2 B' U2 L",
        "U R L2 U L B D' R' U D F2 D' B2 D2 R2 F2 U F2 L'"
      ],
      
      "KQJ4F": [
        "F U2 F' L2 D2 B' D2 B' F' L2 F' U' F2 L' D' F U' L' R' U R2",
        "U' D' R2 U L' D2 B U L2 U' R2 U' L2 B2 U L2 F2 D2 B' D2",
        "R F2 L2 U L' F2 R U2 F2 B2 U R2 D B2 L2 D' R2 D B' L2",
        "D B' U' F2 U2 F D2 L2 U2 L2 B' F' L2 F' R D F R2 B' U2 L",
        "U R L2 U L B D' R' U D F2 D' B2 D2 R2 F2 U F2 L'"
      ],
      
      "KQJ4F": [
        "F U2 F' L2 D2 B' D2 B' F' L2 F' U' F2 L' D' F U' L' R' U R2",
        "U' D' R2 U L' D2 B U L2 U' R2 U' L2 B2 U L2 F2 D2 B' D2",
        "R F2 L2 U L' F2 R U2 F2 B2 U R2 D B2 L2 D' R2 D B' L2",
        "D B' U' F2 U2 F D2 L2 U2 L2 B' F' L2 F' R D F R2 B' U2 L",
        "U R L2 U L B D' R' U D F2 D' B2 D2 R2 F2 U F2 L'"
      ],
      
    };

    let solves = [];
    let scrambles = [];
    let idAtual = "";
    let solveIndex = 0;

    function verificarID() {
      const id = document.getElementById("idInput").value.trim().toUpperCase();
      if (!scramblesPorID[id]) {
        alert("ID inválido!");
        return;
      }

      idAtual = id;
      scrambles = scramblesPorID[id];
      solves = [];
      solveIndex = 0;

      // Em vez de mostrar imediatamente os scrambles, mostramos o aviso de gravação
      document.getElementById("idContainer").style.display = "none";
      document.getElementById("confirmContainer").style.display = "block";
    }

    function confirmarGravacao() {
      // Aqui, mais tarde, irá ser adicionado o código do Realtime Database para incrementar o contador deste ID
      // Por enquanto, apenas prosseguir para mostrar o conteúdo de solves

      document.getElementById("confirmContainer").style.display = "none";
      document.getElementById("solveContainer").style.display = "block";
      mostrarProximoScramble();
    }

    function mostrarProximoScramble() {
      if (solveIndex >= 5) {
        finalizarSessao();
        return;
      }
      document.getElementById("scramble").innerText = `Scramble #${solveIndex + 1}: ${scrambles[solveIndex]}`;
      document.getElementById("tempoInput").value = "";

      // Limpa checkboxes de penalidade
      document.querySelector('input[name="plus2"]').checked = false;
      document.querySelector('input[name="dnf"]').checked = false;
    }

    function submeterTempo() {
      const tempoStr = document.getElementById("tempoInput").value;
      const plus2Checked = document.querySelector('input[name="plus2"]').checked;
      const dnfChecked = document.querySelector('input[name="dnf"]').checked;

      if (!tempoStr || isNaN(parseFloat(tempoStr))) {
        alert("Insere um tempo válido antes de submeter!");
        return;
      }
      const tempo = parseFloat(tempoStr);

      let tempoParaCalculo, displayTempo, penalidade;
      if (dnfChecked) {
        tempoParaCalculo = Infinity;
        displayTempo = "DNF";
        penalidade = "DNF";
      } else if (plus2Checked) {
        tempoParaCalculo = tempo + 2;
        displayTempo = (tempo + 2).toFixed(2);
        penalidade = "+2";
      } else {
        tempoParaCalculo = tempo;
        displayTempo = tempo.toFixed(2);
        penalidade = "";
      }

      solves.push({
        scramble: scrambles[solveIndex],
        tempo: tempoParaCalculo,
        displayTempo: displayTempo,
        penalidade: penalidade
      });

      atualizarTabela();
      solveIndex++;
      mostrarProximoScramble();
    }

    function atualizarTabela() {
      const tbody = document.querySelector("#tabelaTempos tbody");
      tbody.innerHTML = "";
      solves.forEach(s => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${s.scramble}</td><td>${s.displayTempo}</td><td>${s.penalidade}</td>`;
        tbody.appendChild(tr);
      });
    }

    function finalizarSessao() {
      // Esconde todo o container de solves (remove barra branca no topo)
      document.getElementById("solveContainer").style.display = "none";

      document.getElementById("resultsContainer").style.display = "block";
      const finalTbody = document.querySelector("#finalTabela tbody");
      finalTbody.innerHTML = "";
      solves.forEach(s => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${s.scramble}</td><td>${s.displayTempo}</td><td>${s.penalidade}</td>`;
        finalTbody.appendChild(tr);
      });

      calcularEstatisticas();
    }

    function calcularEstatisticas() {
      // Calcular Single (sem “s”)
      const temposValidosParaSingle = solves
        .map(s => s.tempo)
        .filter(t => t !== Infinity);

      let bestSingleDisplay;
      if (temposValidosParaSingle.length > 0) {
        const best = Math.min(...temposValidosParaSingle);
        bestSingleDisplay = best.toFixed(2);
      } else {
        bestSingleDisplay = "DNF";
      }
      document.getElementById("bestSingle").innerText = `Single: ${bestSingleDisplay}`;

      // Calcular Ao5 (sem “s”)
      const temposParaAo5 = solves.map(s => s.tempo);
      if (temposParaAo5.filter(t => t === Infinity).length > 1) {
        document.getElementById("finalAo5").innerText = "Ao5: DNF";
        return;
      }
      const classificados = [...temposParaAo5].sort((a, b) => a - b);
      if (classificados.length === 5) {
        classificados.shift();
        classificados.pop();
      }
      const soma = classificados.reduce((acc, val) => acc + val, 0);
      const media = soma / classificados.length;
      document.getElementById("finalAo5").innerText = `Ao5: ${media.toFixed(2)}`;
    }
  </script>
</body>
</html>
